import{a as p,b as u}from"./chunk-XCEYEA5J.js";import{a as l}from"./chunk-XHS7ECCB.js";import{L as a,O as n,T as i,k as s,z as r}from"./chunk-FJDYQ5PW.js";var h=class o{_httpClient=i(l);_errorHandler=i(p);authUrl=`${u.apiBaseUrl}/auth`;isLoggedSubject=new s(this.hasToken());isSellerSubject=new s(this.getRole()==="seller");currentUserSubject=new s(this.getStoredUser());isLogged$=this.isLoggedSubject.asObservable();isSeller$=this.isSellerSubject.asObservable();currentUser$=this.currentUserSubject.asObservable();hasToken(){return localStorage.getItem("authToken")!==null}getRole(){return localStorage.getItem("userRole")}getStoredUser(){let t=localStorage.getItem("userData");return t?JSON.parse(t):null}singupService(t){return this._httpClient.post(`${this.authUrl}/signup`,t).pipe(a(e=>{e.token&&(localStorage.setItem("authToken",e.token),this.isLoggedSubject.next(!0)),e.data&&(localStorage.setItem("userData",JSON.stringify(e.data)),e.data.role&&(localStorage.setItem("userRole",e.data.role),this.isSellerSubject.next(e.data.role==="seller")),this.currentUserSubject.next(e.data))}),r(this._errorHandler.handleError))}loginService(t){return this._httpClient.post(`${this.authUrl}/login`,t,{withCredentials:!0}).pipe(a(e=>{e.token&&(localStorage.setItem("authToken",e.token),this.isLoggedSubject.next(!0)),e.data&&(localStorage.setItem("userData",JSON.stringify(e.data)),e.data.role&&(localStorage.setItem("userRole",e.data.role),this.isSellerSubject.next(e.data.role==="seller")),this.currentUserSubject.next(e.data))}),r(this._errorHandler.handleError))}logout(){localStorage.removeItem("authToken"),localStorage.removeItem("userRole"),localStorage.removeItem("userData"),this.isLoggedSubject.next(!1),this.isSellerSubject.next(!1),this.currentUserSubject.next(null)}forgetPassService(t){return this._httpClient.post(`${this.authUrl}/forgotPassword`,{email:t}).pipe(r(this._errorHandler.handleError))}resetPassService(t,e){return this._httpClient.patch(`${this.authUrl}/resetPassword/${e}`,{password:t}).pipe(r(this._errorHandler.handleError))}changePassService(t){return this._httpClient.patch(`${this.authUrl}/changePassword`,{password:t}).pipe(r(this._errorHandler.handleError))}static \u0275fac=function(e){return new(e||o)};static \u0275prov=n({token:o,factory:o.\u0275fac,providedIn:"root"})};export{h as a};
